I"~ª<p>Code duplication is a serious issue in software development, because it is one of the primary causes of high maintenance cost and reduction in quality. In cases of code duplication, it increases the code base size, thereby increasing the cost of any subsequent changes or bug fixes, causing development and test efforts to be unnecessarily duplicated. From a technical perspective, code duplication is a big problem because it violates some of the core underlying principles - it violates the DRY Principle and the Abstraction Principle. In this article, we review the concepts underlying code duplication, the costs of code duplication, different types of code duplication and how code duplication may be refactored.</p>

<h2 id="background-story">Background Story</h2>

<p>John was pulling yet another all-nighter, trying to do some last minute fixes to prepare for the next release. The code base had grown so large, it took longer and longer to implement features, including even ‚Äúsimple‚Äù requests, and not to mention the bugs that came along. It was just one of those standard accounting applications, but there were some quirks needed to support the growing base of international customers.</p>

<p>At first, it was quite simple, but then there were more and more features, and customizations. So now, when there was just one change somewhere, it needed to be replicated to several other parts, and every change took longer and longer to do. Now John was spending more and more time maintaining those code ‚Äúclones‚Äù. He was thinking to himself: is there a better way?</p>

<h2 id="what-is-code-duplication">What is Code Duplication?</h2>

<p>Code duplication refers to the presence of the same (or similar) code occurring multiple times within the code base. Each of these duplicate code blocks are referred to as code clones, or just clones. Code clones could be detected via manual inspection of the source code(identifying identical or similar code), or by automated Clone Detection mechanisms.</p>

<h3 id="what-are-the-costs-of-code-duplication">What are the costs of Code Duplication?</h3>

<ul>
  <li>Code duplication increases overall code base size, thereby increasing the overall maintenance effort</li>
  <li>Maintenance effort is a big part of overall cost, so this leads to an overall more costly project</li>
  <li>Any bugs or vulnerabilities within the code are replicated when blocks of code are copy-pasted, decreasing quality</li>
  <li>Any changes or bugs affecting code clones need to be repeated for each clone, increasing development effort (changing / fixing each clone), test effort (re-testing each of the affected clones), and causes quality risk (there is possibility of human error that a code clone was overlooked or that changes were not propagated in the same way)</li>
</ul>

<h3 id="how-does-code-duplication-violate-general-principles">How does Code Duplication violate general principles?</h3>

<p>The following are some core principles in software development:</p>
<ul>
  <li>Don‚Äôt Repeat Yourself (DRY) Principle states that every piece of knowledge within a system must have a <em>single</em> representatoion within a system (i.e. no duplication).</li>
  <li>Abstraction Principle indicates that appropriate levels of abstraction should be used, in order to minimize code duplication</li>
</ul>

<p>So as can be seen above, from the technical perspective, code duplication violates core principles and best practices.</p>

<h3 id="why-does-code-duplication-occur">Why does Code Duplication occur?</h3>

<p>Some of the root causes for code duplication are as follows:</p>

<ul>
  <li>Developers inadvertedly copy-paste code because it‚Äôs faster (in the immediate short term) and they may be under pressure to fulfill deadlines</li>
  <li>Developers inadvertedly copy-paste code and do not refactor it because they do not know how to identify the abstraction and how to refactor it</li>
  <li>Multiple developers are working but are unaware that another developer has already implemented a certain functionality, so then the second developer implements it again</li>
</ul>

<h2 id="what-are-the-different-types-of-code-duplication---part-i">What are the different types of Code Duplication? - Part I</h2>

<p>The following will be used as a motivating example for illustrating the different types of code duplication. This is a banking application which keeps track of account balances, it prints a balance in the morning, then after transactions are performed, it again prints the account balance.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Register initial set of bank accounts</span>

<span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">Double</span><span class="o">&gt;</span> <span class="n">accountBalances</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">Double</span><span class="o">&gt;();</span>
<span class="n">accountBalances</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="mf">5000.00</span><span class="o">);</span>
<span class="n">accountBalances</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="mf">4300.00</span><span class="o">);</span>
<span class="n">accountBalances</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="mf">6900.00</span><span class="o">);</span>

<span class="c1">// Display the balance for all accounts</span>

<span class="kt">double</span> <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>

<span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">accountBalances</span><span class="o">.</span><span class="na">size</span><span class="o">();</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
	<span class="kt">double</span> <span class="n">accountBalance</span> <span class="o">=</span> <span class="n">accountBalances</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
	<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Balance for account "</span> <span class="o">+</span> <span class="n">i</span> <span class="o">+</span> <span class="s">" is: "</span> <span class="o">+</span> <span class="n">accountBalance</span><span class="o">);</span>
	<span class="n">total</span> <span class="o">+=</span> <span class="n">accountBalance</span><span class="o">;</span>
<span class="o">}</span>

<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Total balance for all accounts: "</span> <span class="o">+</span> <span class="n">total</span><span class="o">);</span>

<span class="c1">// Then, some further accounts are registered</span>

<span class="n">accountBalances</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="mf">7500.00</span><span class="o">);</span>
<span class="n">accountBalances</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="mf">8900.00</span><span class="o">);</span>

<span class="c1">// There could be transactions performed as well, and any other business logic</span>

<span class="c1">// However, at the end of the day, we need to again display the account balances</span>
<span class="c1">// so the simple "quick" solution is to copy-paste the code above and use it again below</span>

<span class="n">total</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>

<span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">accountBalances</span><span class="o">.</span><span class="na">size</span><span class="o">();</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
	<span class="kt">double</span> <span class="n">accountBalance</span> <span class="o">=</span> <span class="n">accountBalances</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
	<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Balance for account "</span> <span class="o">+</span> <span class="n">i</span> <span class="o">+</span> <span class="s">" is: "</span> <span class="o">+</span> <span class="n">accountBalance</span><span class="o">);</span>
	<span class="n">total</span> <span class="o">+=</span> <span class="n">accountBalance</span><span class="o">;</span>
<span class="o">}</span>

<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Total balance for all accounts: "</span> <span class="o">+</span> <span class="n">total</span><span class="o">);</span>
</code></pre></div></div>

<h3 id="character-for-character-code-duplication">Character-for-Character Code Duplication</h3>

<p>The following is a simple example of identical looking code, i.e. direct copy paste. The first part of the code has been copied, so the second part of is the code clone. Here, we did just one copy (to keep the example short), but it could have been copied even more times, resulting in multiple clones.</p>

<p>The first block displays the bank account balance:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">double</span> <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>

<span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">accountBalances</span><span class="o">.</span><span class="na">size</span><span class="o">();</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
	<span class="kt">double</span> <span class="n">accountBalance</span> <span class="o">=</span> <span class="n">accountBalances</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
	<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Balance for account "</span> <span class="o">+</span> <span class="n">i</span> <span class="o">+</span> <span class="s">" is: "</span> <span class="o">+</span> <span class="n">accountBalance</span><span class="o">);</span>
	<span class="n">total</span> <span class="o">+=</span> <span class="n">accountBalance</span><span class="o">;</span>
<span class="o">}</span>

<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Total balance for all accounts: "</span> <span class="o">+</span> <span class="n">total</span><span class="o">);</span>
</code></pre></div></div>

<p>Then after some transactions are executed, the copy-pasted block of code again prints the account balance:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">total</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>

<span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">accountBalances</span><span class="o">.</span><span class="na">size</span><span class="o">();</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
	<span class="kt">double</span> <span class="n">accountBalance</span> <span class="o">=</span> <span class="n">accountBalances</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
	<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Balance for account "</span> <span class="o">+</span> <span class="n">i</span> <span class="o">+</span> <span class="s">" is: "</span> <span class="o">+</span> <span class="n">accountBalance</span><span class="o">);</span>
	<span class="n">total</span> <span class="o">+=</span> <span class="n">accountBalance</span><span class="o">;</span>
<span class="o">}</span>

<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Total balance for all accounts: "</span> <span class="o">+</span> <span class="n">total</span><span class="o">);</span>
</code></pre></div></div>

<h3 id="token-for-token-code-duplication">Token-for-Token Code Duplication</h3>

<p>However, there is also the possibility that there were some slight modifications that needed to be done, resulting in renaming, some minor changes such as different messages being shown, etc.</p>

<p>Later, due to various change requests, the two blocks of code continue to further evolve, for example, the requirement could be that for the afternoon account display, it should also report the highest and lowest account balances. Perhaps later there will also be a requirement to display not only the morning and afternoon account balance, but also the evening balance, resulting in yet another copy-paste.</p>

<p>The following block prints the account balance in the morning:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">double</span> <span class="n">totalMorning</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>

<span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">accountBalances</span><span class="o">.</span><span class="na">size</span><span class="o">();</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
	<span class="kt">double</span> <span class="n">accountBalance</span> <span class="o">=</span> <span class="n">accountBalances</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
	<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Morning balance for account "</span> <span class="o">+</span> <span class="n">i</span> <span class="o">+</span> <span class="s">" is: "</span> <span class="o">+</span> <span class="n">accountBalance</span><span class="o">);</span>
	<span class="n">totalMorning</span> <span class="o">+=</span> <span class="n">accountBalance</span><span class="o">;</span>
<span class="o">}</span>

<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Total morning balance for all accounts: "</span> <span class="o">+</span> <span class="n">totalMorning</span><span class="o">);</span>
</code></pre></div></div>

<p>Then, that code was copy-pasted and (with some minor renaming from ‚Äúmorning‚Äù to ‚Äúafternoon‚Äù and some other small variations), it looks quite similar:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">double</span> <span class="n">totalAfternoon</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>

<span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">accountBalances</span><span class="o">.</span><span class="na">size</span><span class="o">();</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
	<span class="kt">double</span> <span class="n">accountBalance</span> <span class="o">=</span> <span class="n">accountBalances</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
	<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Afternoon balance for account "</span> <span class="o">+</span> <span class="n">i</span> <span class="o">+</span> <span class="s">" is: "</span> <span class="o">+</span> <span class="n">accountBalance</span><span class="o">);</span>
	<span class="n">totalAfternoon</span> <span class="o">+=</span> <span class="n">accountBalance</span><span class="o">;</span>
<span class="o">}</span>

<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Total afternoon balance for all accounts: "</span> <span class="o">+</span> <span class="n">totalAfternoon</span><span class="o">);</span>
</code></pre></div></div>

<h3 id="functional-code-duplication">Functional Code Duplication</h3>

<p>The examples above focused on syntax-based similarities within code. However, it is also possible that whilst syntax is different, two blocks of code are functionally identical or similar. This may occur for example, if two different developers independently implemented the code.</p>

<p>Once again, going back to the original code:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">double</span> <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>

<span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">accountBalances</span><span class="o">.</span><span class="na">size</span><span class="o">();</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
	<span class="kt">double</span> <span class="n">accountBalance</span> <span class="o">=</span> <span class="n">accountBalances</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
	<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Balance for account "</span> <span class="o">+</span> <span class="n">i</span> <span class="o">+</span> <span class="s">" is: "</span> <span class="o">+</span> <span class="n">accountBalance</span><span class="o">);</span>
	<span class="n">total</span> <span class="o">+=</span> <span class="n">accountBalance</span><span class="o">;</span>
<span class="o">}</span>

<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Total balance for all accounts: "</span> <span class="o">+</span> <span class="n">total</span><span class="o">);</span>
</code></pre></div></div>

<p>The following code was written by another developer in the team, who needed to implement the exact same functionality, but he implemented it in a different way, thus it is functionally equivalent:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">total</span> <span class="o">=</span> <span class="n">accountBalances</span><span class="o">.</span><span class="na">stream</span><span class="o">().</span><span class="na">mapToDouble</span><span class="o">(</span><span class="nl">Double:</span><span class="o">:</span><span class="n">doubleValue</span><span class="o">).</span><span class="na">sum</span><span class="o">();</span>

<span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
<span class="k">while</span><span class="o">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="n">accountBalances</span><span class="o">.</span><span class="na">size</span><span class="o">())</span> <span class="o">{</span>
	<span class="kt">double</span> <span class="n">accountBalance</span> <span class="o">=</span> <span class="n">accountBalances</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
	<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Balance for account "</span> <span class="o">+</span> <span class="n">i</span> <span class="o">+</span> <span class="s">" is: "</span> <span class="o">+</span> <span class="n">accountBalance</span><span class="o">);</span>
	<span class="n">i</span><span class="o">++;</span>
<span class="o">}</span>

<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Total balance for all accounts: "</span> <span class="o">+</span> <span class="n">total</span><span class="o">);</span>
</code></pre></div></div>

<h3 id="putting-it-all-together">Putting it all together</h3>

<p>In practice, it quite often happens that the above cases of code duplication may be comined together.</p>

<p>First block:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">double</span> <span class="n">totalMorning</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>

<span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">accountBalances</span><span class="o">.</span><span class="na">size</span><span class="o">();</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
	<span class="kt">double</span> <span class="n">accountBalance</span> <span class="o">=</span> <span class="n">accountBalances</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
	<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Morning balance for account "</span> <span class="o">+</span> <span class="n">i</span> <span class="o">+</span> <span class="s">" is: "</span> <span class="o">+</span> <span class="n">accountBalance</span><span class="o">);</span>
	<span class="n">totalMorning</span> <span class="o">+=</span> <span class="n">accountBalance</span><span class="o">;</span>
<span class="o">}</span>

<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Total morning balance for all accounts: "</span> <span class="o">+</span> <span class="n">totalMorning</span><span class="o">);</span>
</code></pre></div></div>

<p>Second block:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">double</span> <span class="n">totalAfternoon</span> <span class="o">=</span> <span class="n">accountBalances</span><span class="o">.</span><span class="na">stream</span><span class="o">().</span><span class="na">mapToDouble</span><span class="o">(</span><span class="nl">Double:</span><span class="o">:</span><span class="n">doubleValue</span><span class="o">).</span><span class="na">sum</span><span class="o">();</span>

<span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
<span class="k">while</span><span class="o">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="n">accountBalances</span><span class="o">.</span><span class="na">size</span><span class="o">())</span> <span class="o">{</span>
	<span class="kt">double</span> <span class="n">accountBalance</span> <span class="o">=</span> <span class="n">accountBalances</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
	<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Afternoon balance for account "</span> <span class="o">+</span> <span class="n">i</span> <span class="o">+</span> <span class="s">" is: "</span> <span class="o">+</span> <span class="n">accountBalance</span><span class="o">);</span>
	<span class="n">i</span><span class="o">++;</span>
<span class="o">}</span>

<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Total afternoon balance for all accounts: "</span> <span class="o">+</span> <span class="n">totalAfternoon</span><span class="o">);</span>
</code></pre></div></div>

<h2 id="what-are-the-different-types-of-code-duplication---part-ii">What are the different types of Code Duplication? - Part II</h2>

<h3 id="code-duplication-with-data-variation">Code Duplication with Data Variation</h3>

<h4 id="duplication">Duplication</h4>

<p>Suppose we have a block of code somewhere which performs withdrawal from an account:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">double</span> <span class="n">accountBalance</span> <span class="o">=</span> <span class="mi">3000</span><span class="o">;</span>
<span class="kt">double</span> <span class="n">withdrawal</span> <span class="o">=</span> <span class="mi">50</span><span class="o">;</span>

<span class="k">if</span><span class="o">(</span><span class="n">withdrawal</span> <span class="o">&lt;=</span> <span class="n">accountBalance</span><span class="o">)</span> <span class="o">{</span>
	<span class="n">accountBalance</span> <span class="o">-=</span> <span class="n">withdrawal</span><span class="o">;</span>
	<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Successful withdrawal, updated balance: "</span> <span class="o">+</span> <span class="n">accountBalance</span><span class="o">);</span>
<span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
	<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Failed withdrawal"</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Then later on, either within the same method, or perhaps another method, there is similar looking code, but just with different parameter values, but everything else is the same:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">double</span> <span class="n">accountBalance2</span> <span class="o">=</span> <span class="mi">6000</span><span class="o">;</span>
<span class="kt">double</span> <span class="n">withdrawal2</span> <span class="o">=</span> <span class="mi">7000</span><span class="o">;</span>

<span class="k">if</span><span class="o">(</span><span class="n">withdrawal2</span> <span class="o">&lt;=</span> <span class="n">accountBalance2</span><span class="o">)</span> <span class="o">{</span>
	<span class="n">accountBalance2</span> <span class="o">-=</span> <span class="n">withdrawal2</span><span class="o">;</span>
	<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Successful withdrawal, updated balance: "</span> <span class="o">+</span> <span class="n">accountBalance2</span><span class="o">);</span>
<span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
	<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Failed withdrawal"</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<h4 id="refactoring">Refactoring</h4>

<p>Firstly, we identify that the code is the same (it was copy-pasted) and the only difference is the parameters. So then we make a separate method, which encapsulates the common code, and the parameters are passed into it:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">withdraw</span><span class="o">(</span><span class="kt">double</span> <span class="n">accountBalance</span><span class="o">,</span> <span class="kt">double</span> <span class="n">withdrawal</span><span class="o">)</span> <span class="o">{</span>
	<span class="k">if</span><span class="o">(</span><span class="n">withdrawal</span> <span class="o">&lt;=</span> <span class="n">accountBalance</span><span class="o">)</span> <span class="o">{</span>
		<span class="n">accountBalance</span> <span class="o">-=</span> <span class="n">withdrawal</span><span class="o">;</span>
		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Successful withdrawal, updated balance: "</span> <span class="o">+</span> <span class="n">accountBalance</span><span class="o">);</span>
	<span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Failed withdrawal"</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Then, the first block references the common withdrawal method:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">double</span> <span class="n">accountBalance</span> <span class="o">=</span> <span class="mi">3000</span><span class="o">;</span>
<span class="kt">double</span> <span class="n">withdrawal</span> <span class="o">=</span> <span class="mi">50</span><span class="o">;</span>

<span class="n">withdraw</span><span class="o">(</span><span class="n">accountBalance</span><span class="o">,</span> <span class="n">withdrawal</span><span class="o">);</span>
</code></pre></div></div>

<p>Similar principle applies for the second block, also referencing the same withdrawal method:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">double</span> <span class="n">accountBalance2</span> <span class="o">=</span> <span class="mi">6000</span><span class="o">;</span>
<span class="kt">double</span> <span class="n">withdrawal2</span> <span class="o">=</span> <span class="mi">7000</span><span class="o">;</span>

<span class="n">withdraw</span><span class="o">(</span><span class="n">accountBalance2</span><span class="o">,</span> <span class="n">withdrawal2</span><span class="o">);</span>
</code></pre></div></div>

<h3 id="code-duplication-with-type-variation">Code Duplication with Type Variation</h3>

<h4 id="duplication-1">Duplication</h4>

<p>Suppose we have this block of code:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">stringList</span> <span class="o">=</span> <span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="s">"Apple"</span><span class="o">,</span> <span class="s">"Banana"</span><span class="o">,</span> <span class="s">"Orange"</span><span class="o">);</span>

<span class="k">for</span><span class="o">(</span><span class="nc">String</span> <span class="n">stringElement</span> <span class="o">:</span> <span class="n">stringList</span><span class="o">)</span> <span class="o">{</span>
	<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">stringElement</span><span class="o">);</span>
<span class="o">}</span>

<span class="kt">int</span> <span class="n">stringListSize</span> <span class="o">=</span> <span class="n">stringList</span><span class="o">.</span><span class="na">size</span><span class="o">();</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">stringListSize</span><span class="o">);</span>
</code></pre></div></div>

<p>Then we have another similar-looking block of code, except that there‚Äôs a difference in types (now it‚Äôs an integer list instead of a string list):</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">intList</span> <span class="o">=</span> <span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="mi">60</span><span class="o">,</span> <span class="mi">23</span><span class="o">,</span> <span class="mi">80</span><span class="o">,</span> <span class="mi">90</span><span class="o">);</span>

<span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">intElement</span> <span class="o">:</span> <span class="n">intList</span><span class="o">)</span> <span class="o">{</span>
	<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">intElement</span><span class="o">);</span>
<span class="o">}</span>

<span class="kt">int</span> <span class="n">intListSize</span> <span class="o">=</span> <span class="n">intList</span><span class="o">.</span><span class="na">size</span><span class="o">();</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">intListSize</span><span class="o">);</span>
</code></pre></div></div>

<h4 id="refactoring-1">Refactoring</h4>

<p>We isolate the common code using generics, to handle the variation in type:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">private</span> <span class="kd">static</span> <span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="kt">void</span> <span class="nf">showInfo</span><span class="o">(</span><span class="nc">List</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">)</span> <span class="o">{</span>
	<span class="k">for</span><span class="o">(</span><span class="no">T</span> <span class="n">element</span> <span class="o">:</span> <span class="n">list</span><span class="o">)</span> <span class="o">{</span>
		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">element</span><span class="o">);</span>
	<span class="o">}</span>
	
	<span class="kt">int</span> <span class="n">listSize</span> <span class="o">=</span> <span class="n">list</span><span class="o">.</span><span class="na">size</span><span class="o">();</span>
	<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">listSize</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Then, we refactor the first block:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">stringList</span> <span class="o">=</span> <span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="s">"Apple"</span><span class="o">,</span> <span class="s">"Banana"</span><span class="o">,</span> <span class="s">"Orange"</span><span class="o">);</span>
<span class="n">showInfo</span><span class="o">(</span><span class="n">stringList</span><span class="o">);</span>
</code></pre></div></div>

<p>And we also refactor the second block:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">intList</span> <span class="o">=</span> <span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="mi">60</span><span class="o">,</span> <span class="mi">23</span><span class="o">,</span> <span class="mi">80</span><span class="o">,</span> <span class="mi">90</span><span class="o">);</span>
<span class="n">showInfo</span><span class="o">(</span><span class="n">intList</span><span class="o">);</span>	
</code></pre></div></div>

<h3 id="code-duplication-with-function-variation">Code Duplication with Function Variation</h3>

<h4 id="duplication-2">Duplication</h4>

<p>We have a block of code:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="n">left</span> <span class="o">=</span> <span class="mi">5</span><span class="o">;</span>
<span class="kt">int</span> <span class="n">right</span> <span class="o">=</span> <span class="mi">7</span><span class="o">;</span>

<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Left: "</span> <span class="o">+</span> <span class="n">left</span><span class="o">);</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Right: "</span> <span class="o">+</span> <span class="n">right</span><span class="o">);</span>

<span class="kt">int</span> <span class="n">result</span> <span class="o">=</span> <span class="n">left</span> <span class="o">+</span> <span class="n">right</span><span class="o">;</span>

<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Result: "</span> <span class="o">+</span> <span class="n">result</span><span class="o">);</span>
</code></pre></div></div>

<p>Then we have another block of code, but this time the computation uses a different function (multiplication instead of addition):</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="n">left2</span> <span class="o">=</span> <span class="mi">5</span><span class="o">;</span>
<span class="kt">int</span> <span class="n">right2</span> <span class="o">=</span> <span class="mi">7</span><span class="o">;</span>

<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Left: "</span> <span class="o">+</span> <span class="n">left2</span><span class="o">);</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Right: "</span> <span class="o">+</span> <span class="n">right2</span><span class="o">);</span>

<span class="kt">int</span> <span class="n">result2</span> <span class="o">=</span> <span class="n">left2</span> <span class="o">*</span> <span class="n">right2</span><span class="o">;</span>

<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Result: "</span> <span class="o">+</span> <span class="n">result2</span><span class="o">);</span>
</code></pre></div></div>

<h4 id="refactoring-2">Refactoring</h4>

<p>We now create a common method, extrapolating the abstraction that there is a difference in the binary function:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">runBinary</span><span class="o">(</span><span class="nc">BiFunction</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">,</span> <span class="nc">Integer</span><span class="o">,</span> <span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">binaryFunction</span><span class="o">,</span> <span class="kt">int</span> <span class="n">left</span><span class="o">,</span> <span class="kt">int</span> <span class="n">right</span><span class="o">)</span> <span class="o">{</span>
	<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Left: "</span> <span class="o">+</span> <span class="n">left</span><span class="o">);</span>
	<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Right: "</span> <span class="o">+</span> <span class="n">right</span><span class="o">);</span>
	
	<span class="kt">int</span> <span class="n">result</span> <span class="o">=</span> <span class="n">left</span> <span class="o">+</span> <span class="n">right</span><span class="o">;</span>
	
	<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Result: "</span> <span class="o">+</span> <span class="n">result</span><span class="o">);</span>		
<span class="o">}</span>
</code></pre></div></div>

<p>We apply it to the first code block:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="n">left</span> <span class="o">=</span> <span class="mi">5</span><span class="o">;</span>
<span class="kt">int</span> <span class="n">right</span> <span class="o">=</span> <span class="mi">7</span><span class="o">;</span>

<span class="n">runBinary</span><span class="o">((</span><span class="n">l</span><span class="o">,</span> <span class="n">r</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">l</span> <span class="o">+</span> <span class="n">r</span><span class="o">,</span> <span class="n">left</span><span class="o">,</span> <span class="n">right</span><span class="o">);</span>
</code></pre></div></div>

<p>Then we apply it to the second code block:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="n">left2</span> <span class="o">=</span> <span class="mi">5</span><span class="o">;</span>
<span class="kt">int</span> <span class="n">right2</span> <span class="o">=</span> <span class="mi">7</span><span class="o">;</span>

<span class="n">runBinary</span><span class="o">((</span><span class="n">l</span><span class="o">,</span> <span class="n">r</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">l</span> <span class="o">*</span> <span class="n">r</span><span class="o">,</span> <span class="n">left2</span><span class="o">,</span> <span class="n">right2</span><span class="o">);</span>
</code></pre></div></div>

<h2 id="summary">Summary</h2>

<p>In this article, we have reviewed the definition of code duplication, analyzed reasons why code duplication should be minimized / avoided (both the technical perspective as well as the financial perspective), and we identified the different types of code duplication as well as how it can be refactored to remove the duplication. The core benefits that can be realized by this is reducing the maintenance cost of software as well as increasing the quality.</p>

<h2 id="references">References</h2>

<p>Code duplication:</p>
<ul>
  <li><a href="https://en.wikipedia.org/wiki/Duplicate_code">Duplicate Code (Wikipedia)</a></li>
  <li><a href="https://refactoring.guru/smells/duplicate-code">Duplicate Code (Refactoring Guru)</a></li>
  <li><a href="https://simpleprogrammer.com/types-of-duplication-in-code/">Types of Duplication in Code (Simple Programmer)</a></li>
  <li><a href="https://solidsourceit.wordpress.com/2012/08/03/does-source-code-duplication-matter/">Does source code duplication matter? (SolidSourceIT)</a></li>
  <li><a href="http://www.informit.com/articles/article.aspx?p=1400866">Refactoring Ruby: Bad Smells in Code - Duplicated Code (Informit)</a></li>
  <li><a href="https://www.sharmaprakash.com.np/four-types-of-duplication-in-source-code/">Four Types of Duplication in Source Code (Prakash)</a></li>
</ul>

<p>Principles:</p>
<ul>
  <li><a href="https://en.wikipedia.org/wiki/Don%27t_repeat_yourself">Don‚Äôt Repeat Yourself (Wikipedia)</a></li>
  <li><a href="https://en.wikipedia.org/wiki/Abstraction_principle_(computer_programming)">Abstraction Principle (Wikipedia)</a></li>
  <li><a href="https://en.wikipedia.org/wiki/Rule_of_three_(computer_programming)">Rule of three (Wikipedia)</a></li>
</ul>
:ET